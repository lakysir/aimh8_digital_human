"use strict";const e=require("./common/vendor.js"),a={__name:"index",setup(a){const t=e.ref(1),o=e.ref(0),n=e.ref(0),l=e.ref("未登录"),i=e.ref("去登陆"),u=e.index.getStorageSync("phoneNum"),d=e.index.getStorageSync("user_id");var r=e.index.getStorageSync("user_type"),s=0;""!==r&&void 0!==r||(r=-1),r>=0&&(i.value="修改信息"),3==r?(s=d,l.value="运营商"):s=e.index.getStorageSync("partner_id"),console.log(s),1==r||2==r?l.value="VIP":4==r?l.value="训练员":0==r&&(l.value="普通用户"),o.value=e.index.getStorageSync("nicename"),n.value=e.index.getStorageSync("benefit");const v=[{id:0,name:"代运营合成"},{id:1,name:"我的合成"}],c=e.ref(1),g=e.ref(0),f=e.ref(!1),h=e.ref(!0),m=e.ref([]);e.ref(!1);const p=e.ref(!1);e.ref("");const x=e.ref(""),w=async()=>{if(!(""===r||void 0===r||r<0))if(!f.value&&h.value){f.value=!0;try{const a=await(async(a=1)=>{if(!(""===r||void 0===r||r<0))try{const o=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{getgenefiles:!0,filetype:t.value,username:u,user_id:d,page_size:12,page:a}});return console.log("profile data:",o.data),o.data.code>=0?(g.value=o.data.total_pages,g.value<=0&&(h.value=!1),{code:0,data:{list:o.data.files_list||[]}}):{code:o.data.code,message:o.data.msg}}catch(o){return console.error("获取视频列表失败:",o),{code:-1,message:o.message}}})(c.value);if(console.log("获取到新数据:",a),a.code>=0){const e=a.data.list;if(!e||0===e.length)return console.log("没有新数据"),1===c.value&&(m.value=[]),void(h.value=!1);m.value=1===c.value?e:[...m.value,...e],c.value++,h.value=c.value<=g.value,console.log("数据更新完成:",{currentPage:c.value,totalPages:g.value,hasMore:h.value})}}catch(a){console.error("加载失败:",a)}finally{f.value=!1}}else console.log("退出 loadMore - loading或无更多数据")};e.onMounted((async()=>{e.index.showLoading({title:"正在加载..",mask:!0}),await w(),await y(),e.index.hideLoading()}));const y=async()=>{try{const a=e.index.getStorageSync("phoneNum");if(console.log(a),a.length>=3){const t=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{phoneLogin:a}});t.data.code>=0?(e.index.setStorageSync("benefit",t.data.benefit),n.value=e.index.getStorageSync("benefit")):e.index.showToast({title:"加载数据失败:"+t.data.msg,icon:"none"})}}catch(a){console.error("检查登录状态失败:",a)}finally{e.index.hideLoading()}},S=a=>{const t=m.value.find((e=>e[0]===a));getApp().globalData.currentOptions={video_id:t[0]},e.index.navigateTo({url:"/pages/video/detail2"})},_=async()=>{r<0?e.index.navigateTo({url:"/pages/login/index"}):(x.value=o.value,p.value=!0)},b=async()=>{if(p.value=!0,x.value.trim())try{(await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{updateNikeName:!0,username:u,user_id:d,newNikeName:x.value}})).data.code>=0&&(o.value=x.value,e.index.showToast({title:"修改成功",icon:"none"}),p.value=!1)}catch(a){console.error("修改名字失败:",a)}else e.index.showToast({title:"名字不能为空",icon:"none"})};return(a,u)=>e.e({a:e.t(o.value),b:e.t(e.unref(d)),c:e.t(l.value),d:e.t(n.value),e:e.t(e.unref(d)),f:e.t(i.value),g:e.o(_),h:e.f(v,((a,o,n)=>({a:e.t(a.name),b:a.id,c:e.n(t.value===a.id?"active":""),d:e.o((o=>(async a=>{e.index.showLoading({title:"加载视频..",mask:!0}),m.value=[],h.value=!0,t.value=a,c.value=1,await w(),await y(),e.index.hideLoading()})(a.id)),a.id)}))),i:e.f(m.value,((a,t,o)=>e.e({a:a[8],b:e.o((e=>S(a[0])),a[0]),c:0==a[5]},(a[5],{}),{d:e.t(a[1]),e:a[0],f:e.o((e=>S(a[0])),a[0])}))),j:f.value},(f.value,{}),{k:!h.value&&m.value.length>0},(!h.value&&m.value.length,{}),{l:!h.value&&0===m.value.length},(h.value||m.value.length,{}),{m:e.o(w),n:p.value},p.value?{o:x.value,p:e.o((e=>x.value=e.detail.value)),q:e.o(b),r:e.o((e=>p.value=!1)),s:e.o((()=>{})),t:e.o((()=>{}))}:{})}},t=e._export_sfc(a,[["__scopeId","data-v-80c3c2f5"]]);exports.MiniProgramPage=t;
