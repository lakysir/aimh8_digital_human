"use strict";const e=require("../common/vendor.js"),t=require("../utils/config.js"),i={name:"AvatarCard",props:{avatar:{type:Object,required:!0},has_permission:{type:Boolean,required:!0}},data:()=>({imageLoading:!0,imageError:!1}),computed:{isPrivate(){return 0===this.avatar.isdefault},isOfficial(){return 1===this.avatar.isdefault},isUserListed(){return 2===this.avatar.isdefault}},methods:{getImageUrl:e=>e?e.startsWith("http")||e.startsWith("/static/")?e:t.SERVER_URL+e:"/static/images/default-avatar.png",getBadgeClass(){return this.isPrivate?"badge-private":this.isOfficial?"badge-official":"badge-user"},getBadgeIcon(){return this.isPrivate?"🔒":this.isOfficial?"👑":"👤"},getBadgeText(){return this.isPrivate?"未上架":this.isOfficial?"官方上架":"用户上架"},getOwnerText(){return this.isPrivate?"私人数字人":this.isOfficial?"官方上架":"所有者 "+(this.avatar.nicename||"kuma")},formatDate:e=>e?new Date(e).toLocaleDateString().replace(/\//g,"/"):"2025/3/29",previewAvatar(){if(!this.isPrivate&&this.has_permission)if(this.avatar.preview_video){let t=this.avatar.preview_video;const i=this.getVideoUrl(t,"example.mp4");e.index.navigateTo({url:`/pages/preview/preview?video=${encodeURIComponent(i)}&mainVideo=${encodeURIComponent(this.getVideoUrl(t,"main.mp4"))}&title=${encodeURIComponent(this.avatar.title||"数字人预览")}`})}else e.index.showToast({title:"暂无预览视频",icon:"none"})},handleButtonClick(){this.isPrivate||e.index.navigateTo({url:`/pages/script_editor/script_editor?avatar_id=${this.avatar.id}`})},onImageLoad(e){this.imageLoading=!1,this.imageError=!1},onImageError(e){this.imageLoading=!1,this.imageError=!0,e.target.src="/static/images/default-avatar.png"},getVideoUrl(e,t){let i;return i=e.endsWith("/")?e+t:e+"/"+t,this.getImageUrl(i)},getCoinsPrice(){return!this.avatar.price_min||this.avatar.price_min<10?10:this.avatar.price_min}}};const a=e._export_sfc(i,[["render",function(t,i,a,r,s,n){return e.e({a:s.imageLoading},(s.imageLoading,{}),{b:n.getImageUrl(a.avatar.preview_image),c:n.isPrivate?1:"",d:s.imageLoading?1:"",e:e.o(((...e)=>n.onImageLoad&&n.onImageLoad(...e))),f:e.o(((...e)=>n.onImageError&&n.onImageError(...e))),g:!n.isPrivate&&!s.imageLoading&&a.has_permission},(n.isPrivate||s.imageLoading||a.has_permission,{}),{h:e.t(n.getBadgeIcon()),i:e.t(n.getBadgeText()),j:e.n(n.getBadgeClass()),k:e.t(n.isPrivate?"? ...":a.avatar.title),l:e.t(n.getOwnerText()),m:e.t(n.isPrivate?"-- Coins/分钟":n.getCoinsPrice()+" Coins/分钟"),n:n.isPrivate?1:"",o:e.t(a.avatar.resolution||"1080P"),p:e.t(n.formatDate(a.avatar.createtime)),q:e.t(n.isPrivate?"🔒":"✏️"),r:e.t(n.isPrivate?"私人使用":"文案编辑器"),s:e.n(n.isPrivate?"private-button":"edit-button"),t:e.o(((...e)=>n.handleButtonClick&&n.handleButtonClick(...e))),v:e.o(((...e)=>n.previewAvatar&&n.previewAvatar(...e)))})}]]);wx.createComponent(a);
