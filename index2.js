"use strict";const e=require("./common/vendor.js"),o={__name:"index",setup(o){const a=e.ref(0);e.ref(1);const n=e.index.getStorageSync("phoneNum"),i=e.index.getStorageSync("user_id"),t=e.ref([]),l=e.ref([]);var d=e.index.getStorageSync("user_type");""!==d&&void 0!==d||(d=-1);const r=e.ref(d);e.onMounted((()=>{(async()=>{if(!(d<0)){e.index.showLoading({title:"正在读取列表",mask:!0});try{const o=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{getAllStlData:!0,username:n,user_id:i}});if(console.log(o),o.data.code>=0){console.log(o.data.muban_list);const e=o.data.muban_list.map((e=>({muban_id:e[0],title:e[1],thumbnail:e[2],url:e[3],date:e[12].split(" ")[0],upload_id:e[13][0],upload:e[13][1],operator_id:e[14][0],operator:e[14][1],owner_id:e[15][0],owner:0==e[15][0]?"我自己":e[15][1]})));t.value=e,l.value=new Array(e.length).fill(!1)}else e.index.showToast({title:"获取视频列表失败",icon:"none"})}catch(o){console.error("获取视频列表出错：",o),e.index.showToast({title:"网络错误",icon:"none"})}finally{e.index.hideLoading()}}})()}));const u=o=>{const n=a.value;if(a.value=o.detail.current,l.value[n]){e.index.createVideoContext("video-"+n).stop(),l.value[n]=!1}},s=()=>{d<0?e.index.navigateTo({url:"/pages/login/index"}):e.index.navigateTo({url:"/pages/digtalhuman/index"})},g=()=>{t.value[a.value].url?console.log("Uploading video..."):e.index.showToast({title:"请先选择视频",icon:"none"})},p=()=>{d<0?e.index.navigateTo({url:"/pages/login/index"}):e.index.navigateTo({url:"/pages/document/index"})},v=()=>{d<0?e.index.navigateTo({url:"/pages/login/index"}):e.index.navigateTo({url:"/pages/digtalhuman/manage"})},c=()=>{d<0?e.index.navigateTo({url:"/pages/login/index"}):e.index.navigateTo({url:"/pages/digtalhuman/approve"})};return(o,n)=>e.e({a:e.f(t.value,((o,n,r)=>e.e({a:!l.value[n]},l.value[n]?{c:o.url,d:"video-"+n,e:e.o((e=>(e=>{l.value[e]=!1})(n)),n)}:{b:o.thumbnail},{f:!l.value[n]},l.value[n]?{}:{g:e.o((o=>(o=>{l.value.forEach(((a,n)=>{a&&n!==o&&(e.index.createVideoContext("video-"+n).stop(),l.value[n]=!1)})),l.value[o]=!0,setTimeout((()=>{e.index.createVideoContext("video-"+o).play()}),100)})(n)),n)},{h:e.t(o.title),i:e.t(o.date),j:e.t(o.owner),k:e.t(o.upload),l:e.t(o.operator),m:a.value===n?1:"",n:e.o((o=>(o=>{e.index.showLoading({title:"正在跳转..",mask:!0});const a=t.value[o];0==a.owner_id||a.owner_id==i||a.operator_id==i?(getApp().globalData.currentOptions={videoId:a.muban_id,title:a.title,thumbnail:a.thumbnail},e.index.navigateTo({url:"/pages/transform/index"})):e.index.showToast({title:"只有版权和运营方才能使用",icon:"none"}),e.index.hideLoading()})(n)),n),o:a.value===n?1:"",p:e.o((o=>(o=>{if(d<0)return void e.index.navigateTo({url:"/pages/login/index"});e.index.showLoading({title:"正在跳转..",mask:!0});const a=t.value[o];console.log(a.owner_id),console.log(a.operator_id),console.log(i),0==a.owner_id||a.owner_id==i||a.operator_id==i?(getApp().globalData.currentOptions={muban_id:a.muban_id,title:a.title,date:a.date,operator_id:a.operator_id,operator:a.operator,upload_id:a.upload_id,upload:a.upload,thumbnail:encodeURIComponent(a.thumbnail)},e.index.navigateTo({url:"/pages/publish/edit-copy"})):e.index.showToast({title:"只有版权和运营方才能使用",icon:"none"})})(n)),n),q:a.value===n?1:"",r:n}))),b:e.o(v),c:3===r.value},3===r.value?{d:e.o(c)}:{},{e:a.value===t.value.length?1:"",f:e.o(s),g:a.value,h:e.o(u),i:e.o(g),j:e.o(p)})}},a=e._export_sfc(o,[["__scopeId","data-v-d5eef0cd"]]);exports.MiniProgramPage=a;
