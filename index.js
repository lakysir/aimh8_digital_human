"use strict";const e=require("./common/vendor.js");Math||(a+t)();const a=()=>"./pages/index/components/DoctorTab2.js",t=()=>"./pages/index/components/VideoTab2.js",i={__name:"index",setup(a){const t=e.index.getStorageSync("phoneNum"),i=e.index.getStorageSync("user_id");var n=e.index.getStorageSync("user_type");const o=e.ref(0),l=e.ref(!1);""!==n&&void 0!==n||(n=-1);const s=e.ref(0);s.value=n;const d=[{id:0,name:"智能体"}];n>0&&(d.push({id:1,name:"市场"}),o.value=1);const u=async e=>{o.value=e.detail.current},r=a=>{if(n<0)return void e.index.navigateTo({url:"/pages/login/index"});const t={url:"https://real.aimh8.com/call-up",title:a.name,bot_id:a.bot_id,tts_id:a.tts_id,conversion_id:"",user_id:i,continues:a.continues,fromwebView:1},o=Object.entries(t).map((([e,a])=>`${e}=${encodeURIComponent(a)}`)).join("&");e.index.navigateTo({url:`/pages/webview/webview?${o}`})},c=e.ref(1),v=e.ref(0),g=e.ref(1),p=e.ref(0),f=e.ref(!1),m=e.ref([]),_=e.ref([]),w=async(a=1)=>{if(!(n<0||f.value)){f.value=!0;try{const n=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{getAllReleasefiles:!0,filetype:0,username:t,user_id:i,page_size:8,page:a}});n.data.code>=0&&(m.value=1===a?n.data.files_list:[...m.value,...n.data.files_list],g.value=a,p.value=n.data.total_pages)}catch(o){console.error("获取视频列表失败:",o)}finally{f.value=!1}}},h=async(a=1)=>{if(!f.value){f.value=!0;try{const t=await e.index.request({url:"https://www.aimh8.com/agent/get_agent_list",method:"POST",header:{"Content-Type":"application/json"},data:{}});console.log(t.data),t.data.code>=0&&(_.value=1===a?t.data.list:[..._.value,...t.data.doctor_list],c.value=a,v.value=t.data.total_pages)}catch(t){console.error("获取视频列表失败:",t)}finally{f.value=!1}}},x=async()=>{0===o.value?c.value<v.value&&await h(c.value+1):1===o.value&&g.value<p.value&&await w(g.value+1)};e.onMounted((async()=>{e.index.showLoading({title:"正在加载..",mask:!0}),await h(1),await w(1),e.index.hideLoading()}));const y=a=>{if(n<0)return void e.index.navigateTo({url:"/pages/login/index"});console.log("播放视频:",a);const t=m.value.find((e=>e[0]===a));getApp().globalData.currentOptions={video_id:t[0]},t&&e.index.navigateTo({url:"/pages/video/detail2"})},b=async()=>{l.value=!0;try{await w(1)}finally{l.value=!1}};return(a,t)=>e.e({a:e.f(d,((a,t,i)=>({a:e.t(a.name),b:a.id,c:e.n(o.value===a.id?"active":""),d:e.o((e=>(async e=>{o.value=e})(a.id)),a.id)}))),b:0===o.value,c:e.o(r),d:e.p({doctors:_.value}),e:s.value>0},s.value>0?{f:1===o.value,g:e.o(x),h:e.o(b),i:e.o(y),j:e.p({videos:m.value,"video-refreshing":l.value})}:{},{k:o.value,l:e.o(u),m:e.o(x)})}},n=e._export_sfc(i,[["__scopeId","data-v-c65cca21"]]);exports.MiniProgramPage=n;
