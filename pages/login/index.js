"use strict";const e=require("../../common/vendor.js"),a={__name:"index",setup(a){const n=e.ref(""),t=e.wx$1.getAccountInfoSync().miniProgram.appId,i=async a=>{if(a.detail.code){e.index.showLoading({title:"正在登录",mask:!0});try{const{code:n}=await e.index.login(),i=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{appid:t,code:n,phoneCode:a.detail.code}});console.log(i.data),i.data.code>=0?(e.index.setStorageSync("phoneNum",i.data.phoneNum),e.index.setStorageSync("user_id",i.data.user_id),e.index.setStorageSync("nicename",i.data.nicename),e.index.setStorageSync("benefit",i.data.benefit),e.index.setStorageSync("user_type",i.data.user_type),e.index.setStorageSync("upid",i.data.upid),e.index.setStorageSync("partner_id",i.data.partner_id),e.index.reLaunch({url:"/pages/main/index"})):e.index.showToast({title:"登录失败:"+i.data.msg,icon:"none"})}catch(n){console.error("登录失败:",n),e.index.showToast({title:"登录失败，请重试",icon:"none"})}finally{e.index.hideLoading()}}};return e.onMounted((()=>{(async()=>{e.index.showLoading({title:"正在加载",mask:!0});try{const a=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{appid:t,getWechatMiniProgramTitle:1}});console.log(a.data),a.data.code>=0?n.value=a.data.title:e.index.showToast({title:"加载失败1:"+a.data.msg,icon:"none"})}catch(a){console.error("加载失败2:",a),e.index.showToast({title:"加载失败，请重试",icon:"none"})}finally{e.index.hideLoading()}})(),(async()=>{e.index.showLoading({title:"正在检查登录状态",mask:!0});try{e.index.getStorageSync("phoneNum").length>=3&&e.index.reLaunch({url:"/pages/main/index"})}catch(a){console.error("检查登录状态失败:",a)}finally{e.index.hideLoading()}})()})),(a,t)=>({a:e.t(n.value),b:e.o(i)})}},n=e._export_sfc(a,[["__scopeId","data-v-dd299b8a"]]);wx.createPage(n);
