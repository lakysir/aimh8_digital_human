"use strict";const e=require("../../common/vendor.js"),t={__name:"approve",setup(t){const i=e.index.getStorageSync("phoneNum"),o=e.index.getStorageSync("user_id"),n=e.ref([]),a=async()=>{try{const t=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{getTeamRequestVideos:!0,username:i,user_id:o}});console.log(t),t.data.code>=0?n.value=t.data.muban_list.map((e=>({id:e[0],title:e[1]||"",doctor:e[8][1]||"",operator:e[9][1]||"",uploadtime:e[7]||"",video_url:e[2],check_status:e[6],accept_time:e[4],train_finish_time:e[5]}))):e.index.showToast({title:"获取视频列表失败",icon:"none"})}catch(t){console.error("获取数据失败：",t),e.index.showToast({title:"获取数据失败",icon:"none"})}};e.onMounted((()=>{e.index.showLoading({title:"加载中...",mask:!0}),a(),e.index.hideLoading()}));const s=e=>e.train_finish_time?"已发布":e.accept_time?"训练中":2==e.check_status?"待训练":1==e.check_status?"已拒绝":0==e.check_status?"待审":"",d=e=>{const t=s(e);return{"status-pending":"待训练"===t||"待审"===t,"status-rejected":"未过审"===t,"status-training":"训练中"===t,"status-published":"已发布"===t}},c=e=>"待审"===s(e);return(t,r)=>({a:e.f(n.value,((t,n,r)=>e.e({a:e.t(t.doctor),b:e.t(t.operator),c:e.t(t.uploadtime),d:c(t)},c(t)?{e:e.o((n=>(t=>{e.index.showModal({title:"提示",content:"是否同意本申请，同意后将扣除3000U费用",success:async n=>{if(n.confirm){e.index.showLoading({title:"同意中...",mask:!0});try{const n=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{passdowndiymuban:!0,username:i,user_id:o,muban_id:t.id,cost:3e3}});e.index.hideLoading(),console.log(n.data),n.data.code>=0&&(e.index.showToast({title:"审批成功",icon:"success"}),a())}catch(s){e.index.hideLoading(),e.index.showToast({title:"撤销失败",icon:"none"})}}}})})(t)),n)}:{},{f:c(t)},c(t)?{g:e.o((n=>(t=>{e.index.showModal({title:"提示",content:"是否拒绝本申请，拒绝后将不消耗任何费用",success:async n=>{if(n.confirm){e.index.showLoading({title:"拒绝中...",mask:!0});try{const n=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{refusedowndiymuban:!0,username:i,user_id:o,muban_id:t.id}});e.index.hideLoading(),console.log(n.data),n.data.code>=0&&(e.index.showToast({title:"拒绝成功",icon:"success"}),a())}catch(s){e.index.hideLoading(),e.index.showToast({title:"撤销失败",icon:"none"})}}}})})(t)),n)}:{h:e.t(s(t)),i:e.n(d(t))},{j:n,k:e.o((i=>(t=>{e.index.navigateTo({url:`/pages/video/play?videoUrl=${encodeURIComponent(t.video_url)}`})})(t)),n)})))})}};wx.createPage(t);
