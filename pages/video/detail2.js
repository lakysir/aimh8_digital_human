"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("txvideo")()}const i={onShareAppMessage(i){const t=e.index.getStorageSync("user_id"),o=getApp().globalData.currentOptions;var a=0,d="";return o&&o.video_id&&(a=o.video_id),o&&o.video_title&&(d=o.video_title),console.log(t),console.log(d),console.log(a),{title:`邀请您审阅视频:${d}`||"分享视频",path:`/pages/video/detail2?video_id=${a}&invite_id=${t}`,imageUrl:""}}},t=Object.assign(i,{__name:"detail2",setup(i){const t=e.index.getStorageSync("user_id"),o=e.index.getStorageSync("phoneNum"),a=e.index.getStorageSync("user_type"),d=e.ref(!1);a>0&&(d.value=!0),console.log(`user_type:${a}`);const n=e.ref({video_id:"",title:"",videoUrl:"",username:"",avatar:"",likes:230,date:"",owner_id:0,file_type:0}),s=e.ref(""),l=()=>{e.index.createVideoContext("myVideo").play()},r=()=>{e.index.authorize({scope:"scope.writePhotosAlbum",success(){e.index.showLoading({title:"下载中..."}),e.index.downloadFile({url:n.value.videoUrl,success:i=>{200===i.statusCode&&e.index.saveVideoToPhotosAlbum({filePath:i.tempFilePath,success:()=>{e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"success"})},fail:i=>{e.index.hideLoading(),e.index.showToast({title:"保存失败",icon:"error"}),console.error("保存视频失败：",i)}})},fail:i=>{e.index.hideLoading(),e.index.showToast({title:"下载失败",icon:"error"}),console.error("下载视频失败：",i)}})},fail(){e.index.showModal({title:"提示",content:"需要您授权保存到相册的权限",confirmText:"去设置",success:i=>{i.confirm&&e.index.openSetting()}})}})},c=()=>{e.index.showModal({title:"提示",content:"发布本视频到首页市场栏目，分享给所有人？",success:i=>{i.confirm&&(e.index.showLoading({title:"正在发布..",mask:!0}),e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{releaseOwnerVIdeo:!0,username:o,user_id:t,video_id:n.value.video_id},success:i=>{i.data.code>=0?(getApp().globalData.mainIndex=3,e.index.showToast({title:"发布成功",icon:"success",success:()=>{setTimeout((()=>{e.index.redirectTo({url:"/pages/main/index"})}),1500)}})):e.index.showToast({title:"发布失败",icon:"error"})},fail:()=>{e.index.showToast({title:"网络错误",icon:"error"})}}))}})},u=()=>{const i=n.value.videoUrl.split("/").pop();e.index.showModal({title:"提示",content:"删除这个视频后将无法找回，确认删除？",success:a=>{a.confirm&&(e.index.showLoading({title:"正在删除..",mask:!0}),e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{deleteOwnerVIdeo:!0,username:o,user_id:t,video_id:n.value.video_id,filepath:i},success:i=>{i.data.code>=0?(getApp().globalData.mainIndex=3,e.index.showToast({title:"删除成功",icon:"success",success:()=>{setTimeout((()=>{e.index.redirectTo({url:"/pages/main/index"})}),1500)}})):e.index.showToast({title:"删除失败",icon:"error"})},fail:()=>{e.index.showToast({title:"网络错误",icon:"error"})}}))}})};return e.onMounted((async()=>{e.index.showLoading({title:"加载中...",mask:!0});const i=getCurrentPages(),d=i[i.length-1],s=d.options;console.log(d);let l,r=-1;if(s&&s.video_id)r=s.video_id,l=s.invite_id;else{const e=getApp().globalData.currentOptions;e&&e.video_id&&(r=e.video_id)}if(t>0&&a>0){const i=await e.index.request({url:"https://www.aimh8.com/wechat_index.php",method:"POST",data:{getTargetGeneVideoInfo:!0,username:o,user_id:t,genefile_id:r}});i.data.code>=0&&(e.index.hideLoading(),n.value={username:i.data.videoData[5],video_id:i.data.videoData[0],title:i.data.videoData[1],videoUrl:i.data.videoData[2],date:i.data.videoData[3],owner_id:i.data.videoData[4],file_type:i.data.videoData[6]},console.log("接收到的参数31:",n.value.file_type),getApp().globalData.currentOptions={video_id:i.data.videoData[0],video_title:i.data.videoData[1]},setTimeout((()=>{e.index.createVideoContext("myVideo").play()}),500))}else l&&e.index.showModal({title:"注意",content:"您没有观看权限，是否去注册账号？",showCancel:!1,confirmText:"确认",success:i=>{i.confirm&&e.index.redirectTo({url:`/pages/register/index?invite_id_notowner=${l}`})}}),e.index.hideLoading()})),(i,o)=>e.e({a:d.value},d.value?{b:n.value.videoUrl,c:s.value,d:e.o(l)}:{e:e.o(l),f:e.p({id:"myVideo",src:n.value.videoUrl,poster:s.value,"object-fit":"contain","show-center-play-btn":!0,"auto-play":!0,"initial-time":0,controls:!1})},{g:e.t(n.value.username),h:e.t(n.value.title),i:e.t(n.value.date),j:e.t(n.value.likes),k:n.value.owner_id===e.unref(t)&&1===n.value.file_type},n.value.owner_id===e.unref(t)&&1===n.value.file_type?{l:e.o(c)}:{},{m:e.o(r),n:n.value.owner_id===e.unref(t)},n.value.owner_id===e.unref(t)?{o:e.o(u)}:{})}}),o=e._export_sfc(t,[["__scopeId","data-v-ef04f682"]]);t.__runtimeHooks=2,wx.createPage(o);
