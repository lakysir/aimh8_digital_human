"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/config.js"),a=require("../../common/assets.js"),i={components:{AvatarCard:()=>"../../components/AvatarCard.js"},data:()=>({searchKeyword:"",currentCategory:"all",showFilterDrawer:!1,minPrice:"",maxPrice:"",selectedGender:"all",currentSort:"popular",isLoading:!1,hasMoreData:!0,currentPage:1,pageSize:10,categories:[{id:"all",name:"全部",filter:9},{id:"official",name:"官方上架",filter:1},{id:"user",name:"用户上架",filter:2},{id:"private",name:"未上架",filter:0}],genders:[{id:"all",name:"全部"},{id:"male",name:"男性"},{id:"female",name:"女性"},{id:"other",name:"其他"}],sortOptions:[{id:"popular",name:"热门优先"},{id:"price_asc",name:"价格从低到高"},{id:"price_desc",name:"价格从高到低"},{id:"newest",name:"最新上架"}],avatars:[],has_permission:!1}),computed:{currentFilter(){const e=this.categories.find((e=>e.id===this.currentCategory));return e?e.filter:9},filteredAvatars(){return this.avatars.filter((e=>{var t;return!(this.searchKeyword&&!(null==(t=e.title)?void 0:t.toLowerCase().includes(this.searchKeyword.toLowerCase())))&&(!(this.minPrice&&e.price_min<Number(this.minPrice))&&!(this.maxPrice&&e.price_min>Number(this.maxPrice)))}))}},onLoad(){this.has_permission=t.hasVideoPermission(),this.fetchAvatars(!0)},onReachBottom(){!this.isLoading&&this.hasMoreData&&this.fetchAvatars()},methods:{handleSearch(){this.fetchAvatars(!0)},selectCategory(e){this.currentCategory!==e&&(this.currentCategory=e,this.fetchAvatars(!0))},resetFilters(){this.minPrice="",this.maxPrice="",this.selectedGender="all",this.currentSort="popular"},applyFilters(){this.showFilterDrawer=!1,this.fetchAvatars(!0)},fetchAvatars(a=!1){if(!a&&(this.isLoading||!this.hasMoreData))return;this.isLoading=!0,a&&(this.avatars=[],this.currentPage=1,this.hasMoreData=!0);const i={page:this.currentPage,page_size:this.pageSize,in_market:this.currentFilter};e.index.request({url:t.SERVER_URL+"get_all_avatars",method:"POST",data:i,header:{"content-type":"application/json"},success:t=>{const a=t.data;a.code>0?a.avatars&&a.avatars.length>0?(this.avatars=[...this.avatars,...a.avatars],this.hasMoreData=this.currentPage<a.total_pages,this.currentPage++):this.hasMoreData=!1:e.index.showToast({title:"获取数字人列表失败: "+a.msg,icon:"none"})},fail:t=>{console.error("API请求错误:",t),e.index.showToast({title:"网络错误，请检查连接",icon:"none"})},complete:()=>{this.isLoading=!1}})},loadMockData(){this.isLoading=!0,setTimeout((()=>{const e=[{id:"1",title:"meimei",preview_image:"/static/images/avatar1.jpg",preview_video:"https://example.com/video1.mp4",price_min:30,isdefault:1,resolution:"1080P",createtime:new Date("2025-03-29").getTime()},{id:"2",title:"laky",preview_image:"/static/images/avatar2.jpg",preview_video:"https://example.com/video2.mp4",price_min:10,isdefault:1,resolution:"720P",createtime:new Date("2025-03-27").getTime()}],t=[{id:"3",title:"用户数字人1",preview_image:"/static/images/avatar3.jpg",preview_video:"https://example.com/video3.mp4",price_min:15,isdefault:2,nicename:"kuma",resolution:"1080P",createtime:new Date("2025-03-20").getTime()}],a=[{id:"4",title:"私人数字人",preview_image:"/static/images/avatar4.jpg",isdefault:0,resolution:"1080P",createtime:new Date("2025-04-09").getTime()}];9===this.currentFilter?this.avatars=[...e,...t,...a]:1===this.currentFilter?this.avatars=e:2===this.currentFilter?this.avatars=t:0===this.currentFilter&&(this.avatars=a),this.isLoading=!1}),1e3)}}};if(!Array){e.resolveComponent("avatar-card")()}const r=e._export_sfc(i,[["render",function(t,i,r,s,o,n){return e.e({a:e.o(((...e)=>n.handleSearch&&n.handleSearch(...e))),b:o.searchKeyword,c:e.o((e=>o.searchKeyword=e.detail.value)),d:e.o((e=>o.showFilterDrawer=!0)),e:e.f(o.categories,((t,a,i)=>({a:e.t(t.name),b:a,c:o.currentCategory===t.id?1:"",d:e.o((e=>n.selectCategory(t.id)),a)}))),f:e.f(n.filteredAvatars,((t,a,i)=>({a:"d758be1a-0-"+i,b:e.p({avatar:t,has_permission:o.has_permission}),c:a}))),g:o.isLoading},(o.isLoading,{}),{h:!o.isLoading&&0===n.filteredAvatars.length},o.isLoading||0!==n.filteredAvatars.length?{}:{i:a._imports_0$1},{j:e.o((e=>o.showFilterDrawer=!1)),k:o.minPrice,l:e.o((e=>o.minPrice=e.detail.value)),m:o.maxPrice,n:e.o((e=>o.maxPrice=e.detail.value)),o:e.f(o.genders,((t,a,i)=>({a:e.t(t.name),b:a,c:o.selectedGender===t.id?1:"",d:e.o((e=>o.selectedGender=t.id),a)}))),p:e.f(o.sortOptions,((t,a,i)=>({a:e.t(t.name),b:a,c:o.currentSort===t.id?1:"",d:e.o((e=>o.currentSort=t.id),a)}))),q:e.o(((...e)=>n.resetFilters&&n.resetFilters(...e))),r:e.o(((...e)=>n.applyFilters&&n.applyFilters(...e))),s:o.showFilterDrawer?1:"",t:o.showFilterDrawer},o.showFilterDrawer?{v:e.o((e=>o.showFilterDrawer=!1))}:{})}]]);wx.createPage(r);
